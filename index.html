<!DOCTYPE html>
<html>
<head>
    <title>Calculator</title>
    <style>
    * {

    font: bold 100px Arial, sans-serif;
}
#calculator{

    width: 1000px;
    height: 1000px;

    margin: 100px auto;
    padding: 20px 20px 9px;

    background: #9dd2ea;
    border-radius: 3px;
    box-shadow: 0px 4px #009de4, 0px 10px 15px rgba(0, 0, 0, 0.2);
}

button{

    width: 200px;
    height: 100px;

    background: white;
    border-radius: 3px;
    box-shadow: 0px 4px rgba(0, 0, 0, 0.2);

    margin: 0 7px 11px 0;

    color: #888;
    line-height: 36px;
    text-align: center;

}
button.operator
{
    background: #FFF0F5;
    margin-right: 0;
}
button.reset{
    width: 200px;
    height: 200px;

    background: #ff9fa8;
    box-shadow: 0px 4px #ff7c87;
    color: white;

}
button.eval{
    width: 200px;
    height: 200px;

    background: #f1ff92;
    box-shadow: 0px 4px #9da853;
    color: #888e5f;
}
input{
    height: 200px;
    width: 850px;
    margin: 5px;

    padding: 0 10px;

    background: rgba(0, 0, 0, 0.2);
    border-radius: 3px;
    box-shadow: inset 0px 4px rgba(0, 0, 0, 0.2);

    /* Typography */
    font-size: 100px;
    line-height: 40px;
    color: white;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    text-align: right;
    letter-spacing: 1px
}

button:hover {
    background: #9c89f6;
    box-shadow: 0px 4px #6b54d3;
    color: white;
}

button.eval:hover {
    background: #abb850;
    box-shadow: 0px 4px #717a33;
    color: #ffffff;
}

button.reset:hover {
    background: #f68991;
    box-shadow: 0px 4px #d3545d;
    color: white;
}

button:active {
    box-shadow: 0px 0px #6b54d3;
    top: 4px;
}

button.eval:active {
    box-shadow: 0px 0px #717a33;
    top: 4px;
}

button.reset:active {
    top: 4px;
    box-shadow: 0px 0px #d3545d;
}</style>
</head>
<body>



<div id="calculator" align="center">

    <div>
        <input id="screen" value="0"><br>
    </div>

    <div>
        <button onclick="processNumberButton(this.innerHTML)">1</button>
        <button onclick="processNumberButton(this.innerHTML)">2</button>
        <button onclick="processNumberButton(this.innerHTML)">3</button>
        <button onclick="processOperatorButton(this.innerHTML)" class="operator">+</button>
    </div>

    <div>
        <button onclick="processNumberButton(this.innerHTML)">4</button>
        <button onclick="processNumberButton(this.innerHTML)">5</button>
        <button onclick="processNumberButton(this.innerHTML)">6</button>
        <button onclick="processOperatorButton(this.innerHTML)" class="operator">-</button>
    </div>

    <div>
        <button onclick="processNumberButton(this.innerHTML)">7</button>
        <button onclick="processNumberButton(this.innerHTML)">8</button>
        <button onclick="processNumberButton(this.innerHTML)">9</button>
        <button onclick="processOperatorButton(this.innerHTML)" class="operator">/</button>
    </div>

    <div>
        <button onclick="processNumberButton(this.innerHTML)">0</button>
        <button onclick="processDecimalButton(this.innerHTML)">.</button>
        <button onclick="processPercentageButton(this.innerHTML)">%</button>
        <button onclick="processOperatorButton(this.innerHTML)" class="operator">x</button>
    </div>

    <div>
        <button onclick="processNumberButton(this.innerHTML)">00</button>
        <button onclick="processParenthesesButton(this.innerHTML)">(</button>
        <button onclick="processParenthesesButton(this.innerHTML)">)</button>
        <button onclick="processOperatorButton(this.innerHTML)" class="operator">^</button>
    </div>

    <div>
        <button onclick="processResetButton()" class="reset">C</button>
        <button onclick="processEqualsButton()" class="eval">=</button>
    </div>

</div>

<script>
    

 var input = document.getElementById("screen");
 var operator = ['+','-','x','/'];
 var decimalAdded = false;
 
 function Stack() {
     this.datastore = [];
     this.tos = 0;
     this.push = function (element) {
         this.datastore[this.tos++] = element;
     }
     this.pop = function () {
         return this.datastore[--this.tos];
     }
     this.peek = function () {
         return this.datastore[this.tos-1];
     }
     this.length = function () {
         return this.tos;
     }
 }
 
 function processResetButton()
 {
     input.value = "0";
     decimalAdded = false;
 }
 
 function processEqualsButton()
 {
     var equation = input.value;
     var lastChar = equation.substring(equation.length - 1);
     equation = equation.replace(/x/g,'*');
 
     if(equation.indexOf("%") > -1)
     {
         var res = equation.split('%');
         input.value = (res[0]/100)*res[1];
     }
     else
     {
         if(operator.indexOf(lastChar) > -1)
         {
             equation = equation.substring(0, equation.length - 1);
         }
         if(equation != '')
         {
             if(checkParentheses(equation) == true)
             {
                 var postfix = shuntingYardAlgorithm(equation);
                 var result = evaluatePostfixExpression(postfix);
                 input.value = result;
             }
             else
                 input.value = "Unmatched Parentheses";
         }
             //input.value = eval(equation);
     }
 
     if(input.value.indexOf('.') > -1)
         decimalAdded = true;
     else
         decimalAdded = false;
 
 }
 
 function processOperatorButton(btnValue)
 {
     var inputVal = input.value;
     var lastChar = inputVal.substring(inputVal.length - 1);
     var btnVal = btnValue;
 
     if(inputVal!='' && operator.indexOf(lastChar) == -1)
     {
         input.value += " " + btnVal + " ";
     }
     else if(inputVal == '' && btnVal == '-')
     {
         input.value += " " + btnVal + " ";
     }
 
     if(operator.indexOf(lastChar) > -1 && inputVal.length > 1)
     {
         //input.value.replace(/.$/, btnVal);
         input.value = inputVal.substring(0, inputVal.length - 1) + btnVal;
     }
 
     decimalAdded = false;
 
 }
 
 function processDecimalButton(btnValue)
 {
     var btnVal = btnValue;
 
     if(!decimalAdded)
     {
         input.value += btnVal;
         decimalAdded = true;
     }
 }
 
 function processNumberButton(btnValue)
 {
     if(input.value == '0')
         input.value="";
 
     var btnVal = btnValue;
     input.value += btnVal;
     //decimalAdded = false;
 
 }
 
 function processPercentageButton(btnValue)
 {
     var inputVal = input.value;
     var btnVal = btnValue;
 
     if(inputVal!='' && inputVal.indexOf('-') == -1 && inputVal.indexOf('+') == -1
         && inputVal.indexOf('/') == -1 && inputVal.indexOf('x') == -1 && inputVal.indexOf('^') == -1
         && inputVal.indexOf('(') == -1 && inputVal.indexOf(')') == -1
         && inputVal.indexOf('%') == -1)
     {
         input.value += btnVal;
     }
 }
 
 function processParenthesesButton(btnValue)
 {
     if(input.value == '0')
         input.value="";
 
     var btnVal = btnValue;
 
     if(btnVal == '(')
         input.value += btnVal + " ";
     else
         input.value += " " + btnVal;
 
     decimalAdded = false;
 }
 
 function checkParentheses(expression)
 {
     var s =  new Stack();
 
     for(var i=0; i<expression.length; i++)
     {
         if(expression[i] == '(')
             s.push(expression[i]);
         else if(expression[i] == ')')
             s.pop();
     }
 
     if(s.length() == 0)
     {
         console.log("balanced");
         return true;
     }
     else
     {
         console.log("unbalanced");
         return false;
     }
 
 }
 
 /*to convert infix to postfix expression*/
 
 function shuntingYardAlgorithm(expression)
 {
     var operators = '+-/*^';
     var precedence = {'^':4,'*':3,'/':3,'+':2,'-':2};
     var associative = {'^':'Right','*':'Left','/':'Left','+':'Left','-':'Left'};
     var postfix="";
     var s = new Stack();
     var token;
     var operator1;
     var operator2;
 
     var res1 = expression.split(" ");
 
     for(var i=0; i<res1.length; i++)
     {
         token = res1[i];
 
         if(operators.indexOf(token) == -1 && token != '(' && token != ')')
             postfix+=token + " ";
         else if(operators.indexOf(token) > -1)
         {
             operator1 = token;
             operator2 = s.peek();
             while(operators.indexOf(operator2) > -1 && ((associative[operator2] == 'Left' && precedence[operator1] <= precedence[operator2]) ||
                 (associative[operator2] == 'Right' && precedence[operator1] < precedence[operator2])))
             {
                 postfix+=operator2 + " ";
                 s.pop();
                 operator2 = s.peek();
             }
             s.push(operator1);
         }
         else if(token == '(')
         {
             s.push(token);
         }
         else if(token == ')')
         {
             while(s.peek() != '(')
             {
                 postfix += s.pop() + " ";
             }
             s.pop();
         }
     }
 
     while (s.length()>0){
         postfix += s.pop() + " ";
     }
 
     console.log(postfix);
     return postfix;
 }
 
 function evaluatePostfixExpression(postfix)
 {
     var operators = '+-/*^';
     var s = new Stack();
     var res2 = postfix.split(" ");
 
     for(var j=0; j<res2.length - 1; j++)
     {
         if(operators.indexOf(res2[j]) == -1)
         {
             s.push(res2[j]);
         }
         else
         {
             var op1 = s.pop();
             var op2 = s.pop();
             //var test = op2 + res2[j] + op1;
             var interResult = processIntermediateResult(op1, op2, res2[j]);
             s.push(interResult);
             //console.log(interResult)
         }
     }
 
     return s.pop();
 
 }
 
 function processIntermediateResult(operand1, operand2, operator)
 {
     var interResult;
 
         switch (operator){
         case '+':
             interResult = Number(operand2) + Number(operand1);
             break;
         case '-':
             interResult = Number(operand2) - Number(operand1);
             break;
         case '*':
             interResult = Number(operand2) * Number(operand1);
             break;
         case '/':
             interResult = Number(operand2) / Number(operand1);
             break;
         case '^':
             interResult = Math.pow(Number(operand2), Number(operand1));
             break;
         default:
             console.log("could not be processed");
         }
 
     return interResult;
 }
 
 </script>

</body>
</html>
